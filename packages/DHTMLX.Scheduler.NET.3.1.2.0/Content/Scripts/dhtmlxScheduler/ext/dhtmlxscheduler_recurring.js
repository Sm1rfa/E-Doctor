/*
dhtmlxScheduler.Net v.3.1.2 Professional Evaluation

This software is covered by DHTMLX Evaluation License. Contact sales@dhtmlx.com to get Commercial or Enterprise license. Usage without proper license is prohibited.

(c) Dinamenta, UAB.
*/
Scheduler.plugin(function(e){e.config.occurrence_timestamp_in_utc=!1,e.config.recurring_workdays=[1,2,3,4,5],e.form_blocks.recurring={render:function(){return e.__recurring_template},_ds:{},_init_set_value:function(t,a,n){function i(e){for(var t=0;t<e.length;t++){var a=e[t];"checkbox"==a.type||"radio"==a.type?(u[a.name]||(u[a.name]=[]),u[a.name].push(a)):u[a.name]=a}}function r(e){for(var t=u[e],a=0;a<t.length;a++)if(t[a].checked)return t[a].value}function s(){f("dhx_repeat_day").style.display="none",f("dhx_repeat_week").style.display="none",f("dhx_repeat_month").style.display="none",f("dhx_repeat_year").style.display="none",f("dhx_repeat_"+this.value).style.display="block"
}function d(t){var a=[r("repeat")];for(g[a[0]](a,t);a.length<5;)a.push("");var n="";if(u.end[0].checked)t.end=new Date(9999,1,1),n="no";else if(u.end[2].checked)t.end=l(u.date_of_end.value);else{e.transpose_type(a.join("_")),n=Math.max(1,u.occurences_count.value);var i="week"==a[0]&&a[4]&&-1==a[4].toString().indexOf(e.config.start_on_monday?1:0)?1:0;t.end=e.date.add(new Date(t.start),n+i,a.join("_"))}return a.join("_")+"#"+n}function o(t,a){var n=t.split("#");t=n[0].split("_"),p[t[0]](t,a);var i=u.repeat[{day:0,week:1,month:2,year:3}[t[0]]];
switch(n[1]){case"no":u.end[0].checked=!0;break;case"":u.end[2].checked=!0;var r=a.end;e.config.include_end_by&&(r=e.date.add(r,-1,"day")),u.date_of_end.value=c(r);break;default:u.end[1].checked=!0,u.occurences_count.value=n[1]}i.checked=!0,i.onclick()}e.form_blocks.recurring._ds={start:n.start_date,end:n._end_date};var _=e.date.str_to_date(e.config.repeat_date),l=function(t){var a=_(t);return e.config.include_end_by&&(a=e.date.add(a,1,"day")),a},c=e.date.date_to_str(e.config.repeat_date),h=t.getElementsByTagName("FORM")[0],u=[];
if(i(h.getElementsByTagName("INPUT")),i(h.getElementsByTagName("SELECT")),!e.config.repeat_date_of_end){var v=e.date.date_to_str(e.config.repeat_date);e.config.repeat_date_of_end=v(e.date.add(e._currentDate(),30,"day"))}u.date_of_end.value=e.config.repeat_date_of_end;var f=function(e){return document.getElementById(e)};e.form_blocks.recurring._get_repeat_code=d;var g={month:function(t,a){"d"==r("month_type")?(t.push(Math.max(1,u.month_count.value)),a.start.setDate(u.month_day.value)):(t.push(Math.max(1,u.month_count2.value)),t.push(u.month_day2.value),t.push(Math.max(1,u.month_week2.value)),e.config.repeat_precise||a.start.setDate(1)),a._start=!0
},week:function(t,a){t.push(Math.max(1,u.week_count.value)),t.push(""),t.push("");for(var n=[],i=u.week_day,r=a.start.getDay(),s=!1,d=0;d<i.length;d++)i[d].checked&&(n.push(i[d].value),s=s||i[d].value==r);n.length||(n.push(r),s=!0),n.sort(),e.config.repeat_precise?s||(e.transpose_day_week(a.start,n,1,7),a._start=!0):(a.start=e.date.week_start(a.start),a._start=!0),t.push(n.join(","))},day:function(t){"d"==r("day_type")?t.push(Math.max(1,u.day_count.value)):(t.push("week"),t.push(1),t.push(""),t.push(""),t.push(e.config.recurring_workdays.join(",")),t.splice(0,1))
},year:function(e,t){"d"==r("year_type")?(e.push("1"),t.start.setMonth(0),t.start.setDate(u.year_day.value),t.start.setMonth(u.year_month.value)):(e.push("1"),e.push(u.year_day2.value),e.push(u.year_week2.value),t.start.setDate(1),t.start.setMonth(u.year_month2.value)),t._start=!0}},p={week:function(e){u.week_count.value=e[1];for(var t=u.week_day,a=e[4].split(","),n={},i=0;i<a.length;i++)n[a[i]]=!0;for(var i=0;i<t.length;i++)t[i].checked=!!n[t[i].value]},month:function(e,t){""===e[2]?(u.month_type[0].checked=!0,u.month_count.value=e[1],u.month_day.value=t.start.getDate()):(u.month_type[1].checked=!0,u.month_count2.value=e[1],u.month_week2.value=e[3],u.month_day2.value=e[2])
},day:function(e){u.day_type[0].checked=!0,u.day_count.value=e[1]},year:function(e,t){""===e[2]?(u.year_type[0].checked=!0,u.year_day.value=t.start.getDate(),u.year_month.value=t.start.getMonth()):(u.year_type[1].checked=!0,u.year_week2.value=e[3],u.year_day2.value=e[2],u.year_month2.value=t.start.getMonth())}};e.form_blocks.recurring._set_repeat_code=o;for(var m=0;m<h.elements.length;m++){var y=h.elements[m];switch(y.name){case"repeat":y.onclick=s}}e._lightbox._rec_init_done=!0},set_value:function(t,a,n){var i=e.form_blocks.recurring;
e._lightbox._rec_init_done||i._init_set_value(t,a,n),t.open=!n.rec_type,t.blocked=this._is_modified_occurence(n)?!0:!1;var r=i._ds;r.start=n.start_date,r.end=n._end_date,i.button_click(0,t.previousSibling.firstChild.firstChild,t,t),a&&i._set_repeat_code(a,r)},get_value:function(t,a){if(t.open){var n=e.form_blocks.recurring._ds,i={};this.formSection("time").getValue(i),n.start=i.start_date,a.rec_type=e.form_blocks.recurring._get_repeat_code(n),n._start?(a.start_date=new Date(n.start),a._start_date=new Date(n.start),n._start=!1):a._start_date=null,a._end_date=n.end,a.rec_pattern=a.rec_type.split("#")[0]
}else a.rec_type=a.rec_pattern="",a._end_date=a.end_date;return a.rec_type},focus:function(){},button_click:function(t,a,n,i){i.open||i.blocked?(i.style.height="0px",a.style.backgroundPosition="-5px 20px",a.nextSibling.innerHTML=e.locale.labels.button_recurring):(i.style.height="115px",a.style.backgroundPosition="-5px 0px",a.nextSibling.innerHTML=e.locale.labels.button_recurring_open),i.open=!i.open,e.setLightboxSize()}},e._rec_markers={},e._rec_markers_pull={},e._add_rec_marker=function(e,t){e._pid_time=t,this._rec_markers[e.id]=e,this._rec_markers_pull[e.event_pid]||(this._rec_markers_pull[e.event_pid]={}),this._rec_markers_pull[e.event_pid][t]=e
},e._get_rec_marker=function(e,t){var a=this._rec_markers_pull[t];return a?a[e]:null},e._get_rec_markers=function(e){return this._rec_markers_pull[e]||[]},e._rec_temp=[],function(){var t=e.addEvent;e.addEvent=function(){var a=t.apply(this,arguments);if(a){var n=e.getEvent(a);this._is_modified_occurence(n)&&e._add_rec_marker(n,1e3*n.event_length),n.rec_type&&(n.rec_pattern=n.rec_type.split("#")[0])}return a}}(),e.attachEvent("onEventIdChange",function(t,a){if(!this._ignore_call){this._ignore_call=!0,e._rec_markers[t]&&(e._rec_markers[a]=e._rec_markers[t],delete e._rec_markers[t]);
for(var n=0;n<this._rec_temp.length;n++){var i=this._rec_temp[n];i.event_pid==t&&(i.event_pid=a,this.changeEventId(i.id,a+"#"+i.id.split("#")[1]))}delete this._ignore_call}}),e.attachEvent("onConfirmedBeforeEventDelete",function(e){var t=this.getEvent(e);if(this._is_virtual_event(e)||this._is_modified_occurence(t)&&t.rec_type&&"none"!=t.rec_type){e=e.split("#");var a=this.uid(),n=e[1]?e[1]:t._pid_time/1e3,i=this._copy_event(t);i.id=a,i.event_pid=t.event_pid||e[0];var r=n;i.event_length=r,i.rec_type=i.rec_pattern="none",this.addEvent(i),this._add_rec_marker(i,1e3*r)
}else{t.rec_type&&this._lightbox_id&&this._roll_back_dates(t);var s=this._get_rec_markers(e);for(var d in s)s.hasOwnProperty(d)&&(e=s[d].id,this.getEvent(e)&&this.deleteEvent(e,!0))}return!0}),e.attachEvent("onEventDeleted",function(t,a){!this._is_virtual_event(t)&&this._is_modified_occurence(a)&&(e._events[t]||(a.rec_type=a.rec_pattern="none",this.setEvent(t,a)))}),e.attachEvent("onEventChanged",function(e){if(this._loading)return!0;var t=this.getEvent(e);if(this._is_virtual_event(e)){var e=e.split("#"),a=this.uid();
this._not_render=!0;var n=this._copy_event(t);n.id=a,n.event_pid=e[0];var i=e[1];n.event_length=i,n.rec_type=n.rec_pattern="",this._add_rec_marker(n,1e3*i),this.addEvent(n),this._not_render=!1}else{t.rec_type&&this._lightbox_id&&this._roll_back_dates(t);var r=this._get_rec_markers(e);for(var s in r)r.hasOwnProperty(s)&&(delete this._rec_markers[r[s].id],this.deleteEvent(r[s].id,!0));delete this._rec_markers_pull[e];for(var d=!1,o=0;o<this._rendered.length;o++)this._rendered[o].getAttribute("event_id")==e&&(d=!0);
d||(this._select_id=null)}return!0}),e.attachEvent("onEventAdded",function(e){if(!this._loading){var t=this.getEvent(e);t.rec_type&&!t.event_length&&this._roll_back_dates(t)}return!0}),e.attachEvent("onEventSave",function(e,t){var a=this.getEvent(e);return a.rec_type||!t.rec_type||this._is_virtual_event(e)||(this._select_id=null),!0}),e.attachEvent("onEventCreated",function(e){var t=this.getEvent(e);return t.rec_type||(t.rec_type=t.rec_pattern=t.event_length=t.event_pid=""),!0}),e.attachEvent("onEventCancel",function(e){var t=this.getEvent(e);
t.rec_type&&(this._roll_back_dates(t),this.render_view_data())}),e._roll_back_dates=function(e){e.event_length=(e.end_date.valueOf()-e.start_date.valueOf())/1e3,e.end_date=e._end_date,e._start_date&&(e.start_date.setMonth(0),e.start_date.setDate(e._start_date.getDate()),e.start_date.setMonth(e._start_date.getMonth()),e.start_date.setFullYear(e._start_date.getFullYear()))},e._is_virtual_event=function(e){return-1!=e.toString().indexOf("#")},e._is_modified_occurence=function(e){return e.event_pid&&"0"!=e.event_pid
},e._validId=function(e){return!this._is_virtual_event(e)},e.showLightbox_rec=e.showLightbox,e.showLightbox=function(t){var a=this.locale,n=e.config.lightbox_recurring,i=this.getEvent(t),r=i.event_pid,s=this._is_virtual_event(t);s&&(r=t.split("#")[0]);var d=function(t){var a=e.getEvent(t);return a._end_date=a.end_date,a.end_date=new Date(a.start_date.valueOf()+1e3*a.event_length),e.showLightbox_rec(t)};if((r||1*r===0)&&i.rec_type)return d(t);if(!r||"0"===r||!a.labels.confirm_recurring||"instance"==n||"series"==n&&!s)return this.showLightbox_rec(t);
if("ask"==n){var o=this;dhtmlx.modalbox({text:a.labels.confirm_recurring,title:a.labels.title_confirm_recurring,width:"500px",position:"middle",buttons:[a.labels.button_edit_series,a.labels.button_edit_occurrence,a.labels.icon_cancel],callback:function(e){switch(+e){case 0:return d(r);case 1:return o.showLightbox_rec(t);case 2:return}}})}else d(r)},e.get_visible_events_rec=e.get_visible_events,e.get_visible_events=function(e){for(var t=0;t<this._rec_temp.length;t++)delete this._events[this._rec_temp[t].id];
this._rec_temp=[];for(var a=this.get_visible_events_rec(e),n=[],t=0;t<a.length;t++)a[t].rec_type?"none"!=a[t].rec_pattern&&this.repeat_date(a[t],n):n.push(a[t]);return n},function(){var t=e.isOneDayEvent;e.isOneDayEvent=function(e){return e.rec_type?!0:t.call(this,e)};var a=e.updateEvent;e.updateEvent=function(t){var n=e.getEvent(t);n&&n.rec_type&&(n.rec_pattern=(n.rec_type||"").split("#")[0]),n&&n.rec_type&&!this._is_virtual_event(t)?e.update_view():a.call(this,t)}}(),e.transponse_size={day:1,week:7,month:1,year:12},e.date.day_week=function(e,t,a){e.setDate(1),a=7*(a-1);
var n=e.getDay(),i=1*t+a-n+1;e.setDate(a>=i?i+7:i)},e.transpose_day_week=function(t,a,n,i,r){for(var s=(t.getDay()||(e.config.start_on_monday?7:0))-n,d=0;d<a.length;d++)if(a[d]>s)return t.setDate(t.getDate()+1*a[d]-s-(i?n:r));this.transpose_day_week(t,a,n+i,null,n)},e.transpose_type=function(t){var a="transpose_"+t;if(!this.date[a]){var n=t.split("_"),i=864e5,r="add_"+t,s=this.transponse_size[n[0]]*n[1];if("day"==n[0]||"week"==n[0]){var d=null;if(n[4]&&(d=n[4].split(","),e.config.start_on_monday)){for(var o=0;o<d.length;o++)d[o]=1*d[o]||7;
d.sort()}this.date[a]=function(t,a){var n=Math.floor((a.valueOf()-t.valueOf())/(i*s));n>0&&t.setDate(t.getDate()+n*s),d&&e.transpose_day_week(t,d,1,s)},this.date[r]=function(t,a){var n=new Date(t.valueOf());if(d)for(var i=0;a>i;i++)e.transpose_day_week(n,d,0,s);else n.setDate(n.getDate()+a*s);return n}}else("month"==n[0]||"year"==n[0])&&(this.date[a]=function(t,a){var i=Math.ceil((12*a.getFullYear()+1*a.getMonth()-(12*t.getFullYear()+1*t.getMonth()))/s);i>=0&&t.setMonth(t.getMonth()+i*s),n[3]&&e.date.day_week(t,n[2],n[3])
},this.date[r]=function(t,a){var i=new Date(t.valueOf());return i.setMonth(i.getMonth()+a*s),n[3]&&e.date.day_week(i,n[2],n[3]),i})}},e.repeat_date=function(t,a,n,i,r){i=i||this._min_date,r=r||this._max_date;var s=new Date(t.start_date.valueOf());for(!t.rec_pattern&&t.rec_type&&(t.rec_pattern=t.rec_type.split("#")[0]),this.transpose_type(t.rec_pattern),e.date["transpose_"+t.rec_pattern](s,i);s<t.start_date||e._fix_daylight_saving_date(s,i,t,s,new Date(s.valueOf()+1e3*t.event_length)).valueOf()<=i.valueOf()||s.valueOf()+1e3*t.event_length<=i.valueOf();)s=this.date.add(s,1,t.rec_pattern);
for(;r>s&&s<t.end_date;){var d=e.config.occurrence_timestamp_in_utc?Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds()):s.valueOf(),o=this._get_rec_marker(d,t.id);if(o)n&&a.push(o);else{var _=new Date(s.valueOf()+1e3*t.event_length),l=this._copy_event(t);if(l.text=t.text,l.start_date=s,l.event_pid=t.id,l.id=t.id+"#"+Math.ceil(d/1e3),l.end_date=_,l.end_date=e._fix_daylight_saving_date(l.start_date,l.end_date,t,s,l.end_date),l._timed=this.isOneDayEvent(l),!l._timed&&!this._table_view&&!this.config.multi_day)return;
a.push(l),n||(this._events[l.id]=l,this._rec_temp.push(l))}s=this.date.add(s,1,t.rec_pattern)}},e._fix_daylight_saving_date=function(e,t,a,n,i){var r=e.getTimezoneOffset()-t.getTimezoneOffset();return new Date(r?r>0?n.valueOf()+1e3*a.event_length-60*r*1e3:t.valueOf()-60*r*1e3:i.valueOf())},e.getRecDates=function(t,a){var n="object"==typeof t?t:e.getEvent(t),i=0,r=[];a=a||100;var s=new Date(n.start_date.valueOf()),d=new Date(s.valueOf());if(!n.rec_type)return[{start_date:n.start_date,end_date:n.end_date}];
if("none"==n.rec_type)return[];for(this.transpose_type(n.rec_pattern),e.date["transpose_"+n.rec_pattern](s,d);s<n.start_date||s.valueOf()+1e3*n.event_length<=d.valueOf();)s=this.date.add(s,1,n.rec_pattern);for(;s<n.end_date;){var o=this._get_rec_marker(s.valueOf(),n.id),_=!0;if(o)"none"==o.rec_type?_=!1:r.push({start_date:o.start_date,end_date:o.end_date});else{var l=new Date(s),c=new Date(s.valueOf()+1e3*n.event_length);c=e._fix_daylight_saving_date(l,c,n,s,c),r.push({start_date:l,end_date:c})}if(s=this.date.add(s,1,n.rec_pattern),_&&(i++,i==a))break
}return r},e.getEvents=function(e,t){var a=[];for(var n in this._events){var i=this._events[n];if(i&&i.start_date<t&&i.end_date>e)if(i.rec_pattern){if("none"==i.rec_pattern)continue;var r=[];this.repeat_date(i,r,!0,e,t);for(var s=0;s<r.length;s++)!r[s].rec_pattern&&r[s].start_date<t&&r[s].end_date>e&&!this._rec_markers[r[s].id]&&a.push(r[s])}else this._is_virtual_event(i.id)||a.push(i)}return a},e.config.repeat_date="%m.%d.%Y",e.config.lightbox.sections=[{name:"description",height:130,map_to:"text",type:"textarea",focus:!0},{name:"recurring",type:"recurring",map_to:"rec_type",button:"recurring"},{name:"time",height:72,type:"time",map_to:"auto"}],e._copy_dummy=function(){var e=new Date(this.start_date),t=new Date(this.end_date);
this.start_date=e,this.end_date=t,this.event_length=this.event_pid=this.rec_pattern=this.rec_type=null},e.config.include_end_by=!1,e.config.lightbox_recurring="ask",e.attachEvent("onClearAll",function(){e._rec_markers={},e._rec_markers_pull={},e._rec_temp=[]}),e.__recurring_template='<div class="dhx_form_repeat"> <form> <div class="dhx_repeat_left"> <label><input class="dhx_repeat_radio" type="radio" name="repeat" value="day" />Daily</label><br /> <label><input class="dhx_repeat_radio" type="radio" name="repeat" value="week"/>Weekly</label><br /> <label><input class="dhx_repeat_radio" type="radio" name="repeat" value="month" checked />Monthly</label><br /> <label><input class="dhx_repeat_radio" type="radio" name="repeat" value="year" />Yearly</label> </div> <div class="dhx_repeat_divider"></div> <div class="dhx_repeat_center"> <div style="display:none;" id="dhx_repeat_day"> <label><input class="dhx_repeat_radio" type="radio" name="day_type" value="d"/>Every</label><input class="dhx_repeat_text" type="text" name="day_count" value="1" />day<br /> <label><input class="dhx_repeat_radio" type="radio" name="day_type" checked value="w"/>Every workday</label> </div> <div style="display:none;" id="dhx_repeat_week"> Repeat every<input class="dhx_repeat_text" type="text" name="week_count" value="1" />week next days:<br /> <table class="dhx_repeat_days"> <tr> <td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="1" />Monday</label><br /> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="4" />Thursday</label> </td> <td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="2" />Tuesday</label><br /> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="5" />Friday</label> </td> <td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="3" />Wednesday</label><br /> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="6" />Saturday</label> </td> <td> <label><input class="dhx_repeat_checkbox" type="checkbox" name="week_day" value="0" />Sunday</label><br /><br /> </td> </tr> </table> </div> <div id="dhx_repeat_month"> <label><input class="dhx_repeat_radio" type="radio" name="month_type" value="d"/>Repeat</label><input class="dhx_repeat_text" type="text" name="month_day" value="1" />day every<input class="dhx_repeat_text" type="text" name="month_count" value="1" />month<br /> <label><input class="dhx_repeat_radio" type="radio" name="month_type" checked value="w"/>On</label><input class="dhx_repeat_text" type="text" name="month_week2" value="1" /><select name="month_day2"><option value="1" selected >Monday<option value="2">Tuesday<option value="3">Wednesday<option value="4">Thursday<option value="5">Friday<option value="6">Saturday<option value="0">Sunday</select>every<input class="dhx_repeat_text" type="text" name="month_count2" value="1" />month<br /> </div> <div style="display:none;" id="dhx_repeat_year"> <label><input class="dhx_repeat_radio" type="radio" name="year_type" value="d"/>Every</label><input class="dhx_repeat_text" type="text" name="year_day" value="1" />day<select name="year_month"><option value="0" selected >January<option value="1">February<option value="2">March<option value="3">April<option value="4">May<option value="5">June<option value="6">July<option value="7">August<option value="8">September<option value="9">October<option value="10">November<option value="11">December</select>month<br /> <label><input class="dhx_repeat_radio" type="radio" name="year_type" checked value="w"/>On</label><input class="dhx_repeat_text" type="text" name="year_week2" value="1" /><select name="year_day2"><option value="1" selected >Monday<option value="2">Tuesday<option value="3">Wednesday<option value="4">Thursday<option value="5">Friday<option value="6">Saturday<option value="7">Sunday</select>of<select name="year_month2"><option value="0" selected >January<option value="1">February<option value="2">March<option value="3">April<option value="4">May<option value="5">June<option value="6">July<option value="7">August<option value="8">September<option value="9">October<option value="10">November<option value="11">December</select><br /> </div> </div> <div class="dhx_repeat_divider"></div> <div class="dhx_repeat_right"> <label><input class="dhx_repeat_radio" type="radio" name="end" checked/>No end date</label><br /> <label><input class="dhx_repeat_radio" type="radio" name="end" />After</label><input class="dhx_repeat_text" type="text" name="occurences_count" value="1" />occurrences<br /> <label><input class="dhx_repeat_radio" type="radio" name="end" />End by</label><input class="dhx_repeat_date" type="text" name="date_of_end" value="'+e.config.repeat_date_of_end+'" /><br /> </div> </form> </div> <div style="clear:both"> </div>'
});